[
  {
    "comment": "declare default parameters for get_network_keys test part",
    "include": "_defaults",
    "params": {
      "network": "_required",
      "rootEmail": "root@example.com",
      "networkKeysVar": "networkKeys"
    }
  },

  {
    "comment": "request network keys",
    "request": { "uri": "me/networks/<<network>>/actions/keys" }
  },

  {
    "before": "sleep 3s",
    "comment": "check email inbox, expect network keys request",
    "request": {
      "uri": "debug/inbox/email/<<rootEmail>>?type=request&action=password&target=network"
    },
    "response": {
      "store": "emailInbox",
      "check": [
        {"condition": "json.length >= 1"},
        {"condition": "'{{json.[0].ctx.message.messageType}}' == 'request'"},
        {"condition": "'{{json.[0].ctx.message.action}}' == 'password'"},
        {"condition": "'{{json.[0].ctx.message.target}}' == 'network'"}
      ]
    }
  },

  {
    "comment": "approve key request",
    "request": {
      "uri": "auth/approve/{{emailInbox.[0].ctx.confirmationToken}}",
      "method": "post"
    }
  },

  {
    "before": "sleep 3s",
    "comment": "check email inbox for key request confirmation",
    "request": {
      "uri": "debug/inbox/email/<<rootEmail>>?type=confirmation&action=password&target=network"
    },
    "response": {
      "store": "emailInbox",
      "check": [
        {"condition": "json.length >= 1"},
        {"condition": "'{{json.[0].ctx.message.messageType}}' == 'confirmation'"},
        {"condition": "'{{json.[0].ctx.message.action}}' == 'password'"},
        {"condition": "'{{json.[0].ctx.message.target}}' == 'network'"}
      ]
    }
  },

  {
    "comment": "use confirmation token in email to retrieve network keys",
    "request": {
      "uri": "me/networks/<<network>>/actions/keys/{{emailInbox.[0].ctx.message.requestId}}"
    },
    "response": {
      "store": "<<networkKeysVar>>",
      "check": [
        {"condition": "json.getKeys().length >= 1"}
      ]
    }
  }
]